# 搜索速度

考虑到搜索引擎的功能特点，搜索速度的快慢是非常影响体验的因素；对此，我们做了如下优化：

## 建立一个清晰的**函数调用逻辑**

1. 最初，我们的函数调用比较混乱，一些操作在很多不同函数中存在，例如连接数据库等；在搜索过程中会调用不同的函数，有些操作会重复多次。
2. 优化后，我们尽量保证构建停用词表、分词、查询数据库等耗时操作在整个搜索过程中只进行一次。

## 分离**处理逻辑**，每一步处理尽可能少的数据

- 最初，我们的检索、分析、排序功能耦合度较高，执行过程中有很多冗余信息。例如，如果我们的搜索词中包括"人民法院"等普遍存在的词条，检索返回的结果将会是数据库中几乎全部的文档信息，这些文档信息会包含在一个巨大的list列表中，参与后续的分析、排序，带来了极大的时间、空间成本。

> 搜索“人民法院”，用时在我们的不同的设备上耗时约在20s~60s之间。

- 在优化后，我们尽可能保证每个阶段之间只传递后续必要的信息。例如，在检索时只返回一个文书id列表和分词后的查询词列表，分析时返回一个查询词列表中idf超过某个阈值的部分，排序时只根据这些idf符合要求的查询词对文书id列表进行排序；同时，将构建返回页面的功能解耦出来，单独建立一个函数`construct_page()`，根据文书id列表和页码构建返回结果。

> 经过上述两项优化后，搜索“人民法院”，用时缩减到了2s以内，其他大部分搜索用时更短。

## 使用**数据库原生查询语句**代替django的查询语句

1. django的查询语句相比原生的SQL和mongoDB查询语句多了一层ORM包装，对于简单查询效率影响较小，对于复杂、批量查询效率影响较大。

2. 我们在项目中涉及到查询的部分，全部用SQL的聚合搜索语句和mongoDB的管道进行了替代。

   > 优化后，所有搜索词的用时都缩减到了1s左右。

## 使用**redis**缓存

将最近的查询结果存入redis中，当再次查询/翻页时直接跳到`construct_page()`构建返回页面。